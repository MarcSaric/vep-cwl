#!/usr/bin/env cwl-runner

description: |
    description: "Filtering contigs from VCF"
    Usage:  cwl-runner <this-file-path> options

requirements:
  - import: node-engine.cwl
  - class: ShellCommandRequirement
  - class: InlineJavascriptRequirement
  - class: DockerRequirement
    dockerPull: quay.io/ncigdc/vep-tool:0.1b 

class: CommandLineTool

inputs:
  - id: "#input_vcf"
    type: File 
    label: "Input VCF"
    description: "Input VCF File"
    inputBinding:
        prefix: --input_vcf 

  - id: "#output_vcf"
    type: string 
    label: "Output VCF"
    description: "Path to output filtered/formatted VCF file"
    inputBinding:
        prefix: --output_vcf 

  - id: "#fai"
    type: File
    default: null 
    label: "Fai"
    description: "The FAI file containing the contigs you want to keep. Default is already in docker"
    inputBinding:
        prefix: --fai

  - id: "#assembly"
    type: string 
    default: "GRCh38.d1.vd1" 
    label: "Assembly"
    description: "The assembly name to use in VCF header"
    inputBinding:
        prefix: --assembly

  - id: "#reference"
    type: string 
    default: "GRCh38.d1.vd1.fa" 
    label: "Reference Name"
    description: "The reference fasta name to use in VCF header" 
    inputBinding:
        prefix: --reference

outputs:
  - id: "#vcf_out"
    type: File
    description: "Contig filtered VCF file"
    outputBinding:
        glob: $(inputs['output_vcf'])

  - id: "#log_file"
    type: File
    description: "log file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')

  - id: "#time_file"
    type: File
    description: "time file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')

baseCommand: ["/usr/bin/time", "-v"]

arguments:
  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')
    position: -99
    prefix: "-o"

  - valueFrom: "/home/ubuntu/.virtualenvs/p3/bin/python" 
    position: -98

  - valueFrom: "/home/ubuntu/tools/vep-tool/main.py"
    position: -97

  - valueFrom: "contigfilter"
    position: -96

  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')
    position: 99
    prefix: ">"

  - valueFrom: '2>&1'
    position: 100
    shellQuote: false
