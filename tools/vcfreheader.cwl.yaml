#!/usr/bin/env cwl-runner

description: |
    description: "Formatting VCF header"
    Usage:  cwl-runner <this-file-path> options

requirements:
  - import: node-engine.cwl
  - class: ShellCommandRequirement
  - class: InlineJavascriptRequirement
  - class: DockerRequirement
    dockerPull: quay.io/ncigdc/vep-tool:0.1 

class: CommandLineTool

inputs:
  - id: "#input_vcf"
    type: File 
    label: "Input VCF"
    description: "Input VCF File"
    inputBinding:
        prefix: --input_vcf 

  - id: "#output_vcf"
    type: string 
    label: "Output VCF"
    description: "Path to output formatted VCF file"
    inputBinding:
        prefix: --output_vcf 

  - id: "#patient_barcode"
    type: string 
    label: "Patient Barcode"
    default: "unknown"
    description: "Patient barcode ID"
    inputBinding:
        prefix: --patient_barcode 

  - id: "#case_id"
    type: string 
    default: "unknown"
    label: "Case UUID"
    description: "Unique case ID"
    inputBinding:
        prefix: --case_id 

  - id: "#tumor_barcode"
    type: string 
    default: "unknown"
    label: "Tumor Barcode"
    description: "Tumor sample barcode"
    inputBinding:
        prefix: --tumor_barcode

  - id: "#tumor_aliquot_uuid"
    type: string 
    default: "unknown"
    label: "Tumor Aliquot UUID"
    description: "Tumor sample aliquot UUID"
    inputBinding:
        prefix: --tumor_aliquot_uuid

  - id: "#tumor_bam_uuid"
    type: string 
    default: "unknown"
    label: "Tumor BAM UUID"
    description: "Tumor sample BAM UUID"
    inputBinding:
        prefix: --tumor_bam_uuid

  - id: "#normal_barcode"
    type: string 
    default: "unknown"
    label: "Tumor Barcode"
    description: "Tumor sample barcode"
    inputBinding:
        prefix: --normal_barcode

  - id: "#normal_aliquot_uuid"
    type: string 
    default: "unknown"
    label: "Tumor Aliquot UUID"
    description: "Tumor sample aliquot UUID"
    inputBinding:
        prefix: --normal_aliquot_uuid

  - id: "#normal_bam_uuid"
    type: string 
    default: "unknown"
    label: "Tumor BAM UUID"
    description: "Tumor sample BAM UUID"
    inputBinding:
        prefix: --normal_bam_uuid

  - id: "#caller_workflow_id"
    type: string 
    label: "Caller Workflow ID"
    description: "Caller workflow ID for gdcWorkflow line"
    inputBinding:
        prefix: --caller_workflow_id

  - id: "#caller_workflow_name"
    type: string 
    label: "Caller Workflow Name"
    description: "Caller workflow Name for gdcWorkflow line"
    inputBinding:
        prefix: --caller_workflow_name

  - id: "#caller_workflow_description"
    type: string 
    default: null
    label: "Caller Workflow Description"
    description: "Caller workflow Description for gdcWorkflow line"
    inputBinding:
        prefix: --caller_workflow_description

  - id: "#caller_workflow_version"
    type: string 
    default: null
    label: "Caller Workflow Version"
    description: "Caller workflow Version for gdcWorkflow line"
    inputBinding:
        prefix: --caller_workflow_version

  - id: "#annotation_workflow_id"
    type: string 
    label: "Annotation Workflow ID"
    description: "Annotation workflow ID for gdcWorkflow line"
    inputBinding:
        prefix: --annotation_workflow_id

  - id: "#annotation_workflow_name"
    type: string 
    label: "Annotation Workflow Name"
    description: "Annotation workflow Name for gdcWorkflow line"
    inputBinding:
        prefix: --annotation_workflow_name

  - id: "#annotation_workflow_description"
    type: string 
    default: null
    label: "Annotation Workflow Description"
    description: "Annotation workflow Description for gdcWorkflow line"
    inputBinding:
        prefix: --annotation_workflow_description

  - id: "#annotation_workflow_version"
    type: string 
    default: null
    label: "Annotation Workflow Version"
    description: "Annotation workflow Version for gdcWorkflow line"
    inputBinding:
        prefix: --annotation_workflow_version

outputs:
  - id: "#vcf_out"
    type: File
    description: "Header reformatted VCF file"
    outputBinding:
        glob: $(inputs['output_vcf'])

  - id: "#log_file"
    type: File
    description: "log file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')

  - id: "#time_file"
    type: File
    description: "time file"
    outputBinding:
        glob: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')

baseCommand: ["/usr/bin/time", "-v"]

arguments:
  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.time')
    position: -99
    prefix: "-o"

  - valueFrom: "/home/ubuntu/.virtualenvs/p3/bin/python" 
    position: -98

  - valueFrom: "/home/ubuntu/tools/vep-tool/main.py"
    position: -97

  - valueFrom: "vcfreheader"
    position: -96

  - valueFrom: $(inputs['output_vcf'].substr(0, inputs['output_vcf'].lastIndexOf('.')) + '.logs')
    position: 99
    prefix: ">"

  - valueFrom: '2>&1'
    position: 100
    shellQuote: false
