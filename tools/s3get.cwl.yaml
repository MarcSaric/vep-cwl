#!/usr/bin/env cwl-runner

description: |
  tool for getting a single file from s3 using s3cmd

requirements:
  - import: node-engine.cwl
  - import: envvar-global.cwl
  - class: ShellCommandRequirement
  - class: InlineJavascriptRequirement 
  - class: DockerRequirement
    dockerPull: quay.io/jeremiahsavage/cdis_base:latest

class: CommandLineTool

inputs:

  - id: "#config"
    type: File
    label: "Config File"
    description: "Path to s3 config file"
    inputBinding:
      prefix: --config
      position: 0

  - id: "#url"
    type: string
    label: "URL"
    description: "s3 URL you wish to download"
    inputBinding:
      position: 1

  - id: "#output_path"
    type: string
    label: "Output Path"
    default: "./"
    description: "Path to directory you want to download the files to (./ default)"
    inputBinding:
      position: 2

outputs:
  - id: "#out_file"
    type: File
    description: "object pulled from s3"
    outputBinding:
      glob: $(inputs['output_path'] + '/' + inputs['url'].split(/[\\/]/).pop())

  - id: "#log_file"
    type: File
    description: "log file"
    outputBinding:
      glob: $(inputs['output_path'] + '/' + inputs['url'].split(/[\\/]/).pop() + '.s3get.logs')

  - id: "#time_file"
    type: File
    description: "time file"
    outputBinding:
      glob: $(inputs['output_path'] + '/' + inputs['url'].split(/[\\/]/).pop() + '.s3get.time')

baseCommand: ["time"]

arguments:
  - valueFrom: $(inputs['output_path'] + '/' + inputs['url'].split(/[\\/]/).pop() + '.s3get.time')
    position: -99
    prefix: "-o"

  - valueFrom: "s3cmd"
    position: -98

  - valueFrom: "get"
    position: -97

  - valueFrom: "--force"
    position: -96

  - valueFrom: $(inputs['output_path'] + '/' + inputs['url'].split(/[\\/]/).pop() + '.s3get.logs')
    position: 3
    prefix: ">"

  - valueFrom: '2>&1'
    position: 4
    shellQuote: false

